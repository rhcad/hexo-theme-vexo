<div id="article-banner">
  <h2><%- page.title %></h2>
  <% if (page.show_date !== false) { %>
  <p class="post-date">
    <span><%- date(page.date, "YYYY-MM-DD") %></span>
    <%- partial('_partial/category', { categories: page.categories }) %>
  </p>
  <% } %>
</div>
<div class="app-body-wrapper">
<main class="app-body">
  <article class="post-article">
    <section class="markdown-content"><%- page.content %></section>
    <% if (page.tags && page.tags.length) { %>
      <div class="tags">
        <%- partial('_partial/tag', { tags: page.tags }) %>
      </div>
    <% } %>

    <% if (theme.reward && page.money !== false && /^zh-/.test(config.language || theme.language)) { %>
    <div class="money-like">
      <div class="reward-btn">
        赏
        <span class="money-code">
          <span class="alipay-code">
            <div class="code-image"></div>
            <b>使用支付宝打赏</b>
          </span>
          <span class="wechat-code">
            <div class="code-image"></div>
            <b>使用微信打赏</b>
          </span>
        </span>
      </div>
      <p class="notice"><span>如果本文对您有用，请随意赞赏。</span><span>您的支持将鼓励我继续创作！</span></p>
    </div>
    <% } %>

    <% if (theme.qrcode && page.share !== false) { %>
    <div class="qrcode">
      <canvas id="share-qrcode"></canvas>
      <p class="notice"><%- __('share_qrcode') %></p>
    </div>
    <% } %>

    <% if (page.comment !== false && config.uyan) { %>
    <div id="uyan_frame"></div>
    <% } else if (page.comment !== false && config.changyan && config.changyan.appid) { %>
    <div id="SOHUCS" sid="<%= page.path.replace(/index.html$/, '') %>" ></div>
    <% } %>

    <%- partial('_partial/paginator') %>

  </article>
</main>
</div>

<% if (page.comment !== false && config.uyan) { %>
<script>
var uyan_config = {
  title: '<%= page.title %>',
  url: '<%= url.replace(/index.html$/, '') %>',
  du: '<%= config.url.replace('http://', '') %>'
};
</script>
<script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=<%= config.uyan %>"></script>
<% } else if (page.comment !== false && config.changyan && config.changyan.appid) { %>
<script>
  (function(){
    var appid = '<%= config.changyan.appid %>';
    var conf = '<%= config.changyan.conf %>';
    var width = window.innerWidth || document.documentElement.clientWidth;
    if (width < 960) {
      window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" ' +
              'src="http://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>');
    } else {
      var loadJs = function(d, a) {
        var c = document.getElementsByTagName("head")[0] || document.head || document.documentElement;
        var b = document.createElement("script");
        b.setAttribute("type", "text/javascript");
        b.setAttribute("charset", "UTF-8");
        b.setAttribute("src", d);
        if (typeof a === "function") {
          if (window.attachEvent) {
            b.onreadystatechange = function() {
              var e = b.readyState;
              if (e === "loaded" || e === "complete") {
                b.onreadystatechange = null;
                a()
              }
            }
          } else {
            b.onload = a
          }
        }
        c.appendChild(b)
      };
      loadJs("http://changyan.sohu.com/upload/changyan.js", function() {
        window.changyan.api.config({appid: appid, conf: conf})
      });
    }
  })(); </script>
<% } %>

<script>
  (function () {
    // error image
    var mdImg = $(".markdown-content img");
    mdImg.on('error', function() {
      $(this).attr({
        src: '<%- url_for('css/images/error.png') %>',
        error: this.src
      }).css('cursor', 'help');
    });
    mdImg.css('cursor', 'zoom-in');

    // zoom image
    mdImg.on('click', function() {
      var src = $(this).attr('src');
      var imageW = $(this).width();
      var imageH = $(this).height();
      var win = $(window);
      var text = '<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>';
      var error = $(this).attr('error');

      var zoom = (win.width() * 0.95 / imageW).toFixed(2);
      zoom = Math.max(1, Math.min(2, zoom));
      var transY = ((win.height() - imageH) / 2).toFixed(2);

      if (error) {
        text = text.replace('wrap">', 'wrap">无法访问 ' + error);
      }
      $('body').append(text);
      var wrap = $('.image-view-wrap');
      wrap.addClass('wrap-active');
      $('.image-view-wrap img').css({
        'width': `${imageW}`,
        'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
      });
      $('html').css('overflow', 'hidden');

      wrap.on('click', function() {
        $(this).remove();
        $('html').attr('style', '');
      });
    });

    // qrcode
    new QRious({
      element: document.getElementById('share-qrcode'),
      value: document.location.href
    });

    var md = $('.markdown-content');
    var money = $('.money-like');

    if (money[0] && md.height() < 1200) {
      money.hide();
    }

  })();
</script>